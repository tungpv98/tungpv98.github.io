<?xml version="1.0" encoding="utf-8"?>






<rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0">
    <channel>
        <title>Tung&#39;s Blog</title>
        <link>https://tungpv98.github.io/</link>
        <description></description>
        <generator>Hugo 0.68.3 https://gohugo.io/</generator>
        
            <language>en</language>
        
        
            <managingEditor>tungpv98@gmail.com (gnuT_98)</managingEditor>
        
        
            <webMaster>tungpv98@gmail.com (gnuT_98)</webMaster>
        
        
        <lastBuildDate>Fri, 22 Jan 2021 08:29:47 +0700</lastBuildDate>
        
            <atom:link rel="self" type="application/rss+xml" href="https://tungpv98.github.io/rss.xml" />
        
        
            
                <item>
                    <title>Restful API with Java framework Dropwizard ( ƒê·ªù r·ªëp wi d·ªõt )</title>
                    <link>https://tungpv98.github.io/posts/restful-api-with-java-framework-dropwizard-do-rop-wi-dot/</link>
                    <guid isPermaLink="true">https://tungpv98.github.io/posts/restful-api-with-java-framework-dropwizard-do-rop-wi-dot/</guid>
                    <pubDate>Fri, 22 Jan 2021 08:24:20 +0700</pubDate>
                    <description><![CDATA[<blockquote>
<p>D·∫°o g·∫ßn ƒë√¢y v√¨ nhu c·∫ßu c·ªßa d·ª± √°n, kh√°ch h√†ng mu·ªën team m√¨nh code Java b·∫±ng framework Dropwizard. Qua m·∫•y ng√†y t√¨m hi·ªÉu th√¨ m√¨nh c√≥ m·ªôt v√†i chia s·∫ª nh∆∞ sau :</p>
</blockquote>
<blockquote>
<p>Dropwizard l√† g√¨ ?
<a href="https://www.dropwizard.io/">https://www.dropwizard.io/</a></p>
<p>Dropwizard is a Java framework for developing ops-friendly, high-performance, RESTful web services</p>
<p>L√† m·ªôt framework nh·ªè g·ªçn gi√∫p ch√∫ng ta ph√°t tri·ªÉn API m·ªôt c√°ch nhanh ch√≥ng v√† ti·ªán l·ª£i. C√πng v·ªõi hi·ªáu nƒÉng cao v·ªõi c√°c ·ª©ng d·ª•ng microservice.</p>
</blockquote>
<blockquote>
<p>V√† l·∫≠p tr√¨nh vi√™n ch√∫ng ta bao gi·ªù c≈©ng th·∫ø! Khi h·ªçc m·ªôt ng√¥n ng·ªØ ho·∫∑c framwork m·ªõi, ch√∫ng ta s·∫Ω l√†m m·ªôt project example v·ªõi c√°i ch√∫ng ta ƒëang h·ªçc.M√¨nh c≈©ng v·∫≠y, v·∫≠y n√™n h√¥m nay m√¨nh xin tr√¨nh b√†y c√°ch t·∫°o m·ªôt ·ª©ng d·ª•ng API ƒë∆°n gi·∫£n b·∫±ng Dropwizard.</p>
<p>Bao g·ªìm t·∫°o m·ªõi 1 User, xem danh s√°ch User, xem th√¥ng tin m·ªôt User, c·∫≠p nh·∫≠t User, v√† x√≥a User.</p>
</blockquote>
<h2 id="1-t·∫°o-project-maven">1. T·∫°o project maven</h2>
<p>ƒê·∫ßu ti√™n m√¨nh s·∫Ω ti·∫øn h√†nh t·∫°o m·ªôt project maven.
{@embed: <a href="https://gist.github.com/tungpv-0974/f2131b561e290ecd80df40524b8e43e9%7D">https://gist.github.com/tungpv-0974/f2131b561e290ecd80df40524b8e43e9}</a>
Sau ƒë·∫•y m√¨nh th√™m c√°c dependency c·∫ßn thi·∫øt nh∆∞ <code>dropwizard</code> v√† <code>lombok</code>:</p>
<p>{@embed: <a href="https://gist.github.com/tungpv-0974/207fbd8d694baa1ae986bd78deddf55b%7D">https://gist.github.com/tungpv-0974/207fbd8d694baa1ae986bd78deddf55b}</a></p>
<h2 id="2-config">2. Config</h2>
<p>Ti·∫øn h√†nh t·∫°o class <code>AppConfig</code> extends class <code>Configuration</code> nh∆∞ sau:
{@embed: <a href="https://gist.github.com/tungpv-0974/85e003a49509aca7f40c66efc20e2c5b%7D">https://gist.github.com/tungpv-0974/85e003a49509aca7f40c66efc20e2c5b}</a></p>
<p>T·∫°o file config.yml ƒë·ªÉ config:
{@embed: <a href="https://gist.github.com/tungpv-0974/eb6ad5a1cf7e2c2ec73eaedb40ae9611%7D">https://gist.github.com/tungpv-0974/eb6ad5a1cf7e2c2ec73eaedb40ae9611}</a></p>
<p>V√† cu·ªëi c√πng, ch∆∞∆°ng tr√¨nh n√†o c≈©ng ph·∫£i c√≥ h√†m main ƒë√∫ng kh√¥ng ?</p>
<p>M√¨nh t·∫°o class <code>MainApplication</code> ch·ª©a h√†m <code>main</code> ƒë·ªÉ c√≥ th·ªÉ ch·∫°y ƒë∆∞·ª£c server:
{@embed: <a href="https://gist.github.com/tungpv-0974/88ae8149df180e90cb363fd6ba0a3506%7D">https://gist.github.com/tungpv-0974/88ae8149df180e90cb363fd6ba0a3506}</a></p>
<blockquote>
<p>V·∫≠y l√† ƒë√£ ƒë·ªß ƒë·ªÉ m√¨nh c√≥ th·ªÉ ph√°t tri·ªÉn RestAPI v·ªõi dropwizard!</p>
</blockquote>
<h2 id="implement-resource">Implement Resource</h2>
<p>M√¨nh s·∫Ω t·∫°o ra m·ªôt <code>Model</code> c√≥ t√™n l√† <code>User</code>: <em>(M√¨nh c√≥ s·ª≠ d·ª•ng lombok ƒë·ªÉ kh√¥ng ph·∫£i vi·∫øt constructor, setter v√† getter)</em>
{@embed: <a href="https://gist.github.com/tungpv-0974/56ed24e520a3f5894962d79304b089ec%7D">https://gist.github.com/tungpv-0974/56ed24e520a3f5894962d79304b089ec}</a></p>
<p>Ti·∫øp theo m√¨nh t·∫°o <code>UserResource</code>, <em>(Resource ·ªü dropwizard gi·ªëng nh∆∞ controller trong Spring framework)</em>.</p>
<p>Trong UserResource n√†y m√¨nh c√≥ ƒë·∫ßy ƒë·ªß 5 ph∆∞∆°ng th·ª©c GET, POST, PUT v√† DELETE, ƒë·∫ßy ƒë·ªß cho m·ªôt <code>RestfulAPI</code> ƒë∆°n gi·∫£n :
{@embed: <a href="https://gist.github.com/tungpv-0974/fbc56f1749420b6afd633147f5537225%7D">https://gist.github.com/tungpv-0974/fbc56f1749420b6afd633147f5537225}</a></p>
<p>V·ªõi dropwizard, m√¨nh ph·∫£i ti·∫øn h√†nh ƒëƒÉng k√Ω resource m·ªõi t·∫°o v√†o trong h√†m run() ·ªü class <code>MainApplication</code> th√¨ m·ªõi c√≥ th·ªÉ g·ªçi ƒë·∫øn c√°c ƒë·∫ßu API m√¨nh v·ª´a vi·∫øt ·ªü trong class <code>resource</code>:</p>
<pre><code>    @Override
    public void run(AppConfig configuration, Environment environment) {
        environment.jersey().register(new UserResource());
    }
</code></pre><blockquote>
<p>V·∫≠y l√† xong r·ªìi !</p>
</blockquote>
<p><strong>M√¨nh ti·∫øn h√†nh test API v·ªõi c√°c curl sau:</strong>
{@embed: <a href="https://gist.github.com/tungpv-0974/0d1c229aceb8e644e8c606e5143df1df%7D">https://gist.github.com/tungpv-0974/0d1c229aceb8e644e8c606e5143df1df}</a></p>
<p>M·∫∑c d√π <code>Dropwizard</code> sinh ra ƒë·ªÉ h·ªó tr·ª£ ƒë·ªÉ t·∫°o ra c√°c API, nh∆∞ng n√≥ c≈©ng h·ªó tr·ª£ webview n·∫øu ch√∫ng ta mu·ªën. Trong b√†i sau, m√¨nh s·∫Ω ti·∫øn h√†nh c·∫•u h√¨nh <code>Dropwizard</code> v·ªõi <code>thymeleaf</code> ƒë·ªÉ th√™m giao di·ªán cho webapp n√†y!</p>
<blockquote>
<p>M√åNH ƒê√É C·∫¨P NH·∫¨T PH·∫¶N CONFIG ƒë·ªÉ s·ª≠ d·ª•ng thymeleaf v·ªõi dropwizard ·ªü ƒë√¢y ! <a href="https://viblo.asia/p/dropwizard-view-voi-thymeleaf-template-engine-63vKjv36K2R">https://viblo.asia/p/dropwizard-view-voi-thymeleaf-template-engine-63vKjv36K2R</a></p>
<p>H·∫πn g·∫∑p l·∫°i! üòÄüòÄüòÄ</p>
</blockquote>
<blockquote>
<p>SOURCE CODE M√åNH C√ì ƒê·ªÇ T·∫†I ƒê√ÇY !!! <a href="https://github.com/tungpv-0974/example-dropwizard">https://github.com/tungpv-0974/example-dropwizard</a></p>
</blockquote>
]]></description>
                    
                        
                    
                    
                        
                            
                        
                            
                                
                                    
                                    
                                    
                                        <category domain="https://tungpv98.github.io/tags/dropwizard/">Dropwizard</category>
                                    
                                
                                    
                                    
                                    
                                        <category domain="https://tungpv98.github.io/tags/java/">java</category>
                                    
                                
                                    
                                    
                                    
                                        <category domain="https://tungpv98.github.io/tags/restapi/">restapi</category>
                                    
                                
                            
                        
                    
                </item>
            
        
            
                <item>
                    <title>Optional Java 8</title>
                    <link>https://tungpv98.github.io/posts/optional-java-8/</link>
                    <guid isPermaLink="true">https://tungpv98.github.io/posts/optional-java-8/</guid>
                    <pubDate>Fri, 22 Jan 2021 08:22:52 +0700</pubDate>
                    <description><![CDATA[<blockquote>
<p>N·∫øu b·∫°n l√† m·ªôt l·∫≠p tr√¨nh vi√™n Java, th√¨ b·∫°n h·∫≥n ƒë√£ nghe n√≥i ho·∫∑c tr·∫£i nghi·ªám v·ªÅ NullPointerExceptions trong c√°c ch∆∞∆°ng tr√¨nh c·ªßa m√¨nh. NullPointerExceptions l√† c√°c ngo·∫°i l·ªá ƒë∆∞·ª£c jvm n√©m ra trong qu√° tr√¨nh ch·∫°y.  Ki·ªÉm tra r·ªóng trong c√°c ch∆∞∆°ng tr√¨nh th∆∞·ªùng b·ªã c√°c l·∫≠p tr√¨nh vi√™n b·ªè qua g√¢y ra c√°c l·ªói nghi√™m tr·ªçng. Java 8 ƒë√£ gi·ªõi thi·ªáu<code> Optional&lt;T&gt;</code> ƒë·ªÉ gi√∫p c√°c nh√† ph√°t tri·ªÉn x·ª≠ l√Ω c√°c gi√° tr·ªã null ƒë√∫ng c√°ch.</p>
</blockquote>
<h1 id="optional-l√†-g√¨">Optional l√† g√¨?</h1>
<p>Optional l√† m·ªôt th√πng ch·ª©a cho m·ªôt ƒë·ªëi t∆∞·ª£ng c√≥ th·ªÉ l√† null.
H√£y xem x√©t h√†m findUserById sau, tr·∫£ v·ªÅ m·ªôt ƒë·ªëi t∆∞·ª£ng <code>User</code> t·ª´ <code>userId</code> truy·ªÅn v√†o.</p>
<pre><code>    User findUserById(String userId) { ... };
</code></pre><p>N·∫øu <code>userId</code> kh√¥ng c√≥ trong c∆° s·ªü d·ªØ li·ªáu th√¨ h√†m tr√™n tr·∫£ v·ªÅ null.  B√¢y gi·ªù, h√£y xem x√©t ƒëo·∫°n m√£ sau:</p>
<pre><code>    User user = findUserById(&quot;667290&quot;);
    System.out.println(&quot;User's Name = &quot; + user.getName());
</code></pre><p>M·ªôt tr∆∞·ªùng h·ª£p ƒë·ªÉ x·∫£y ra <code>NullPointerException</code> ph·ªï bi·∫øn. L·∫≠p tr√¨nh vi√™n ƒë√£ qu√™n ki·ªÉm tra ƒë·ªëi t∆∞·ª£ng <code>User</code> tr∆∞·ªõc khi g·ªçi h√†m <code>user.getName()</code>. B·ªüi v√¨ <code>userId</code> kh√¥ng c√≥ trong csdl n√™n ƒëo·∫°n m√£ tr√™n s·∫Ω t·∫°o ra m·ªôt <code>NullPointerException</code>. Ch√∫ng ta c√≥ th·ªÉ d√πng <code>Optional</code> ƒë·ªÉ gi·∫£i quy·∫øt r·∫Øc r·ªëi n√†y:</p>
<pre><code>Optional&lt;User&gt; findUserById(String userId) { ... };
</code></pre><p>B·∫±ng c√°ch tr·∫£ v·ªÅ <code>Optional&lt;User&gt;</code> t·ª´ h√†m, ch√∫ng ta ƒë√£ n√≥i r√µ v·ªõi nh·ªØng l·ªùi g·ªçi h√†m n√†y r·∫±ng c√≥ th·ªÉ s·∫Ω kh√¥ng c√≥ <code>User</code> n√†o v·ªõi <code>userId</code> ƒë√£ cho. B√¢y gi·ªù l·ªùi g·ªçi h√†m n√†y ch√∫ng ta ph·∫£i x·ª≠ l√Ω nh∆∞ sau :</p>
<pre><code>    Optional&lt;User&gt; optional = findUserById(&quot;667290&quot;);

    optional.ifPresent(user -&gt; {
        System.out.println(&quot;User's name = &quot; + user.getName());    
    })
</code></pre><p>Ph∆∞∆°ng th·ª©c <code>ifPresent()</code> s·∫Ω g·ªçi bi·ªÉu th·ª©c <code>lambda</code> n·∫øu <code>User</code> t·ªìn t·∫°i, n·∫øu kh√¥ng bi·ªÉu th·ª©c <code>lambda</code> s·∫Ω kh√¥ng ƒë∆∞·ª£c g·ªçi.</p>
<h1 id="t·∫°o-ƒë·ªëi-t∆∞·ª£ng-optional">T·∫°o ƒë·ªëi t∆∞·ª£ng Optional</h1>
<h2 id="1-t·∫°o-m·ªôt-optional-r·ªóng">1. T·∫°o m·ªôt <code>Optional</code> r·ªóng</h2>
<pre><code>Optional&lt;User&gt; user = Optional.empty();
</code></pre><h2 id="2-t·∫°o-m·ªôt-optional-ch·ª©a-gi√°-tr·ªã">2. T·∫°o m·ªôt <code>Optional</code> ch·ª©a gi√° tr·ªã</h2>
<pre><code>User user = new User(&quot;667290&quot;, &quot;Sun Bear&quot;);
Optional&lt;User&gt; userOptional = Optional.of(user);
</code></pre><p>N·∫øu ƒë·ªëi s·ªë ƒë∆∞·ª£c cung c·∫•p cho <code>Optional.of()</code> l√† <code>null</code>, th√¨ n√≥ s·∫Ω n√©m ra m·ªôt <code>NullPointerException</code> ngay l·∫≠p t·ª©c v√† ƒë·ªëi t∆∞·ª£ng <code>Optional</code> s·∫Ω kh√¥ng ƒë∆∞·ª£c t·∫°o.</p>
<h2 id="3-t·∫°o-m·ªôt-optional-c√≥-gi√°-tr·ªã-ho·∫∑c-r·ªóng">3. T·∫°o m·ªôt <code>Optional</code> c√≥ gi√° tr·ªã ho·∫∑c r·ªóng</h2>
<pre><code>Optional&lt;User&gt; userOptional = Optional.ofNullable(user);
</code></pre><p>N·∫øu ƒë·ªëi s·ªë ƒë∆∞·ª£c truy·ªÅn ƒë·∫øn <code>Optional.ofNullable()</code>kh√¥ng ph·∫£i l√† <code>null</code>, th√¨ n√≥ s·∫Ω tr·∫£ v·ªÅ m·ªôt <code>Optional</code> ch·ª©a gi√° tr·ªã ƒë∆∞·ª£c ch·ªâ ƒë·ªãnh, n·∫øu kh√¥ng n√≥ s·∫Ω tr·∫£ v·ªÅ m·ªôt <code>Optional</code> tr·ªëng.</p>
<h1 id="ki·ªÉm-tra-gi√°-tr·ªã-c·ªßa-optional">Ki·ªÉm tra gi√° tr·ªã c·ªßa <code>Optional</code></h1>
<h2 id="1-ispresent">1. isPresent()</h2>
<p>Ph∆∞∆°ng th·ª©c <code>isPresent ()</code> tr·∫£ v·ªÅ <code>true</code> n·∫øu T√πy ch·ªçn ch·ª©a gi√° tr·ªã kh√°c r·ªóng, n·∫øu kh√¥ng, n√≥ tr·∫£ v·ªÅ <code>false</code>.</p>
<pre><code>    if(optional.isPresent()) {
        System.out.println(&quot;Value found - &quot; + optional.get());
    } else {
        System.out.println(&quot;Optional is empty&quot;);
    }	
</code></pre><h2 id="2-ifpresent">2. ifPresent()</h2>
<p>Ph∆∞∆°ng th·ª©c <code>ifPresent ()</code> cho ph√©p g·ªçi bi·ªÉu th·ª©c <code>lambda</code> b√™n trong n·∫øu <code>optional</code> c√≥ gi√° tr·ªã. N√≥ kh√¥ng c√≥ t√°c d·ª•ng g√¨ n·∫øu <code>Optional</code> tr·ªëng.</p>
<pre><code>optional.ifPresent(value -&gt; {
    System.out.println(&quot;Value found - &quot; + value);
});
</code></pre><h1 id="m·ªôt-s·ªë-ph∆∞∆°ng-th·ª©c-optional-cung-c·∫•p">M·ªôt s·ªë ph∆∞∆°ng th·ª©c <code>Optional</code> cung c·∫•p</h1>
<h2 id="1-get">1. get()</h2>
<p>Ph∆∞∆°ng th·ª©c <code>get ()</code> c·ªßa <code>Optional</code> tr·∫£ v·ªÅ m·ªôt gi√° tr·ªã n·∫øu n√≥ t·ªìn t·∫°i, n·∫øu kh√¥ng n√≥ s·∫Ω n√©m <code>NoSuchElementException</code>.</p>
<pre><code>User user = optional.get()
</code></pre><h2 id="2-orelse">2. orElse()</h2>
<p><code>orElse ()</code> tr·∫£ v·ªÅ gi√° tr·ªã m·∫∑c ƒë·ªãnh n·∫øu Optional tr·ªëng. H√£y xem x√©t v√≠ d·ª• sau:</p>
<pre><code>User finalUser = (user != null) ? user : new User(&quot;0&quot;, &quot;Unknown User&quot;);
</code></pre><p>Ta c√≥ th·ªÉ d√πng <code>orElse()</code> nh∆∞ sau:</p>
<pre><code>User finalUser = optionalUser.orElse(new User(&quot;0&quot;, &quot;Unknown User&quot;));
</code></pre><h2 id="3-orelseget">3. orElseGet()</h2>
<p>Kh√¥ng gi·ªëng nh∆∞ <code>orElse ()</code>, tr·∫£ v·ªÅ gi√° tr·ªã m·∫∑c ƒë·ªãnh tr·ª±c ti·∫øp n·∫øu <code>Optional</code> tr·ªëng, <code>orElseGet ()</code> cho ph√©p b·∫°n chuy·ªÉn m·ªôt h√†m m√† ch√∫ng ta cung c·∫•p ƒë∆∞·ª£c g·ªçi khi <code>Optional</code> tr·ªëng.  K·∫øt qu·∫£ c·ªßa h√†m ƒë∆∞·ª£c ch√∫ng ta cung c·∫•p tr·ªü th√†nh gi√° tr·ªã m·∫∑c ƒë·ªãnh c·ªßa <code>Optional</code>.</p>
<pre><code>User finalUser = optionalUser.orElseGet(() -&gt; {
    return new User(&quot;0&quot;, &quot;Unknown User&quot;);
});
</code></pre><h2 id="4-resourcenotfoundexception">4. ResourceNotFoundException()</h2>
<p>Ch√∫ng ta c√≥ th·ªÉ s·ª≠ d·ª•ng <code>orElseThrow () </code>ƒë·ªÉ n√©m m·ªôt ngo·∫°i l·ªá n·∫øu <code>Optional</code> tr·ªëng.  M·ªôt tr∆∞·ªùng h·ª£p ƒëi·ªÉn h√¨nh trong ƒë√≥ ƒëi·ªÅu n√†y c√≥ th·ªÉ h·ªØu √≠ch l√† - tr·∫£ v·ªÅ m·ªôt ngo·∫°i l·ªá <code>ResourceNotFound() </code>t√πy ch·ªânh t·ª´ <code>REST API</code> n·∫øu ƒë·ªëi t∆∞·ª£ng v·ªõi c√°c tham s·ªë y√™u c·∫ßu ƒë∆∞·ª£c ch·ªâ ƒë·ªãnh kh√¥ng t·ªìn t·∫°i.</p>
<pre><code>@GetMapping(&quot;/users/{userId}&quot;)
public User getUser(@PathVariable(&quot;userId&quot;) String userId) {
    return userRepository.findByUserId(userId).orElseThrow(
	    () -&gt; new ResourceNotFoundException(&quot;User not found with userId &quot; + userId);
    );
}
</code></pre><h2 id="5-filter">5. filter()</h2>
<p>Gi·∫£ s·ª≠ ta c√≥ ƒë·ªëi t∆∞·ª£ng <code>Optional&lt;User&gt;</code>.  Mu·ªën ki·ªÉm tra gi·ªõi t√≠nh c·ªßa user ƒë√≥ v√† g·ªçi m·ªôt h√†m n·∫øu ƒë√≥ l√† Male.  ƒê√¢y l√† c√°ch gi√∫p ch√∫ng ta l√†m ƒëi·ªÅu ƒë√≥ b·∫±ng ph∆∞∆°ng ph√°p c≈©:</p>
<pre><code>if(user != null &amp;&amp; user.getGender().equalsIgnoreCase(&quot;MALE&quot;)) {
    // call a function
}
</code></pre><p>B√¢y gi·ªù, S·ª≠ d·ª•ng <code>Optional</code> v·ªõi <code>filter()</code>:</p>
<pre><code>userOptional.filter(user -&gt; user.getGender().equalsIgnoreCase(&quot;MALE&quot;))
.ifPresent(() -&gt; {
      // call a function
})
</code></pre><h2 id="6-map">6. map()</h2>
<p>Gi·∫£ s·ª≠ r·∫±ng ta mu·ªën l·∫•y ƒë·ªãa ch·ªâ c·ªßa ng∆∞·ªùi d√πng n·∫øu ƒë·ªãa ch·ªâ ƒë√£ c√≥ s·∫µn v√† in ƒë·ªãa ch·ªâ ƒë√≥ n·∫øu ng∆∞·ªùi d√πng ƒë·∫øn t·ª´ VietNam.<br>
Ph∆∞∆°ng th·ª©c <code>getAddress () </code>b√™n trong l·ªõp <code>User</code>:</p>
<pre><code>Address getAddress() {
    return this.address;
}
</code></pre><p>ƒê√¢y l√† c√°ch ch√∫ng ta l√†m truy·ªÅn th·ªëng:</p>
<pre><code>if(user != null) {
    Address address = user.getAddress();
    if(address != null &amp;&amp; address.getCountry().equalsIgnoreCase(&quot;VietNam&quot;)) {
	    System.out.println(&quot;User belongs to VietNam&quot;);
    }
}
</code></pre><p>S·ª≠ d·ª•ng <code>Optional</code> v√† <code>map()</code>:</p>
<pre><code>userOptional.map(User::getAddress)
.filter(address -&gt; address.getCountry().equalsIgnoreCase(&quot;VietNam&quot;))
.ifPresent(() -&gt; {
    System.out.println(&quot;User belongs to VietNam&quot;);
});
</code></pre><h1 id="k·∫øt-lu·∫≠n">K·∫øt lu·∫≠n</h1>
<blockquote>
<p>B√†i vi·∫øt n√†y m√¨nh ƒë√£ tr√¨nh b√†y v·ªÅ <code>Optional</code> trong Java 8 v√† c√°ch s·ª≠ d·ª•ng n√≥ ƒë·ªÉ ch√∫ng ta c√≥ th·ªÉ tr√°nh c√°c <code>NullPointerExceptions</code> trong qu√° tr√¨nh ch√∫ng ta l√†m vi·ªác v·ªõi Java. C·∫£m ∆°n m·ªçi ng∆∞·ªùi!</p>
</blockquote>
]]></description>
                    
                        
                    
                    
                        
                            
                        
                            
                        
                    
                </item>
            
        
            
                <item>
                    <title>L·∫≠p L·ªãch C√¥ng Vi·ªác V·ªõi WHENEVER V√Ä DELAYED_JOB Trong Rails</title>
                    <link>https://tungpv98.github.io/posts/lap-lich-cong-viec-voi-whenever-va-delayed-job-trong-rails/</link>
                    <guid isPermaLink="true">https://tungpv98.github.io/posts/lap-lich-cong-viec-voi-whenever-va-delayed-job-trong-rails/</guid>
                    <pubDate>Fri, 22 Jan 2021 08:21:22 +0700</pubDate>
                    <description><![CDATA[<p>Trong b√†i n√†y t√¥i s·∫Ω gi·ªõi thi·ªáu v·ªõi c√°c b·∫°n hai Ruby Gem ƒë∆∞·ª£c s·ª≠ d·ª•ng kh√° nhi·ªÅu trong Rails ƒë·ªÉ l·∫≠p l·ªãch th·ª±c hi·ªán c√¥ng vi·ªác, t·∫°o cronjob v√† tri·ªÉn khai ·ª©ng d·ª•ng m·ªôt c√°ch t·ª± ƒë·ªông, ƒë√≥ l√† Whenever v√† Delayed_job.</p>
<h1 id="i-whenever">I. Whenever</h1>
<p>Whenever l√† m·ªôt Ruby Gem cung c·∫•p c√∫ ph√°p r√µ r√†ng cho vi·ªác vi·∫øt v√† tri·ªÉn khai cronjobs.</p>
<p>Whenever ƒë∆∞·ª£c d√πng ƒë·ªÉ th·ª±c hi·ªán c√°c c√¥ng vi·ªác h√†ng ng√†y nh∆∞ backup h·ªá th·ªëng, ki·ªÉm tra t√†i kho·∫£n ng∆∞·ªùi d√πng,‚Ä¶ v√† c√≥ th·ªÉ ƒë∆∞·ª£c t√≠ch h·ª£p v√†o Capistrano ƒë·ªÉ t·ª± ƒë·ªông t·∫°o cronjobs khi tri·ªÉn khai ·ª©ng d·ª•ng l√™n server.</p>
<p>B·∫°n c√≥ th·ªÉ t√¨m hi·ªÉu v·ªÅ Whenever tai trang Github <a href="https://github.com/javan/whenever">https://github.com/javan/whenever</a>.</p>
<p>ƒê·ªÉ c√†i ƒë·∫∑t Whenever ta ch·∫°y l·ªánh</p>
<p><code>$ gem install whenever</code></p>
<p>ƒê·ªÉ b·∫Øt ƒë·∫ßu s·ª≠ d·ª•ng Whenever, di chuy·ªÉn ƒë·ªÉn th∆∞ m·ª•c ·ª©ng d·ª•ng v√† kh·ªüi t·∫°o Whenever</p>
<pre><code>$ cd ~/projects/my-project
$ wheneverize .
</code></pre><p>L·ªánh wheneverize . s·∫Ω t·∫°o file <code>config/schedule.rb</code></p>
<p>ƒê√¢y l√† m·ªôt v√≠ d·ª• c·ªßa file <code>config/schedule.rb</code></p>
<pre><code># Ki·ªÉm tra t√†i kho·∫£n ng∆∞·ªùi d√πng h√†ng ng√†y v√†o l√∫c 1 gi·ªù s√°ng
every 1.day, :at =&gt; &quot;1:00am&quot; do
    rails &quot;system:account_check&quot;
end
# M·ªói ng√†y ch·∫°y sao l∆∞u h·ªá th·ªëng 2 l·∫ßn, c√°ch nhau 12 ti·∫øng
every 12.hours do
   rails &quot;system:run_backup&quot;
end
</code></pre><p>ƒê·ªÉ ƒë∆∞a c√°c task n√†y v√†o crontab, ta ch·∫°y l·ªánh:</p>
<p><code>~/projects/my-project$ whenever --update-crontab my-project</code></p>
<p>Ta c√≥ th·ªÉ s·ª≠ d·ª•ng whenever v·ªõi Capistrano nh∆∞ sau:</p>
<pre><code>set :application, &quot;my-project&quot;
namespace :deploy do
   desc &quot;Update the crontab file&quot;
   task :update_crontab, :roles =&gt; :app do
      run &quot;cd #{release_path} &amp;&amp; whenever --update-crontab #{application}&quot;
   end
end
after &quot;deploy:create_symlink&quot;, &quot;deploy:update_crontab&quot;
</code></pre><p>ƒê√¢y l√† n·ªôi dung ƒë∆∞·ª£c t·∫°o ra trong crontab khi tri·ªÉn khai ·ª©ng d·ª•ng b·∫±ng Capistrano (ch·∫°y l·ªánh<code> crontab -l</code> t·ª´ terminal ƒë·ªÉ xem)</p>
<pre><code># Begin Whenever generated tasks for: my-project
0 1 * * * /bin/bash -l -c 'cd /var/www/projects/my-project/production/releases/20121219061558 &amp;&amp; RAILS_ENV=production bundle exec rake system:account_check --silent &gt;&gt; /var/www/projects/my-project/production/releases/20121219061558/log/cron_log.txt 2&gt;&amp;1'
0 0,12 * * * /bin/bash -l -c 'cd /var/www/projects/my-project/production/releases/20121219061558 &amp;&amp; RAILS_ENV=production bundle exec rake system:run_backup --silent &gt;&gt; /var/www/projects/my-project/production/releases/20121219061558/log/cron_log.txt 2&gt;&amp;1'
# End Whenever generated tasks for: my-project
</code></pre><h1 id="ii-delayed_job">II. Delayed_job</h1>
<p>Delayed_job l√† Ruby gem th∆∞·ªùng ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ th·ª±c c√°c c√¥ng vi·ªác c√≥ th·ªùi gian ch·∫°y l√¢u ho·∫∑c c√°c c√¥ng vi·ªác mu·ªën th·ª±c hi·ªán trong t∆∞∆°ng lai. C√°c c√¥ng vi·ªác n√†y s·∫Ω ƒë∆∞·ª£c ch·∫°y n·ªÅn v√† kh√¥ng hi·ªÉn th·ªã ƒë·ªëi v·ªõi ng∆∞·ªùi d√πng cu·ªëi.</p>
<p>Delayed_job gi√∫p cho ·ª©ng d·ª•ng ch·∫°y m∆∞·ª£t m√† h∆°n ƒë·ªëi v·ªõi ng∆∞·ªùi d√πng cu·ªëi do c√°c c√¥ng vi·ªác ti√™u t·ªën th·ªùi gian s·∫Ω ƒë∆∞·ª£c th·ª±c hi·ªán ng·∫ßm. C√°c c√¥ng vi·ªác n√†y c√≥ th·ªÉ l√†:</p>
<ul>
<li>G·ª≠i email ƒë·∫øn ng∆∞·ªùi d√πng</li>
<li>Thu nh·ªè ·∫£nh ƒë∆∞·ª£c t·∫£i l√™n</li>
<li>T·∫£i n·ªôi dung t·ª´ m·ªôt trang th·ª© 3</li>
<li>ƒê√°nh ch·ªâ m·ª•c h·ªá th·ªëng</li>
<li>C√°c ph√©p t√≠nh to√°n ƒë√≤i h·ªèi th·ªùi gian‚Ä¶</li>
</ul>
<p>Ngo√†i ra Delayed_job c≈©ng ph√π h·ª£p v·ªõi c√°c c√¥ng vi·ªác ƒë∆∞·ª£c th·ª±c hi·ªán theo m·ªôt k·∫ø ho·∫°ch n√†o ƒë√≥, ch·∫≥ng h·∫°n nh∆∞ ƒë·ªãnh k·ª≥ g·ª≠i b·∫£n tin ƒë·∫øn ng∆∞·ªùi d√πng.</p>
<p>Ban ƒë·∫ßu Delayed_job ƒë∆∞·ª£c vi·∫øt b·ªüi t√°c gi·∫£ Tobias L√ºtke (<a href="https://github.com/tobi),">https://github.com/tobi),</a> sau ƒë√≥ ƒë∆∞·ª£c fork l·∫°i b·ªüi Collective Idea (<a href="https://github.com/collectiveidea">https://github.com/collectiveidea</a>) v√† hi·ªán t·∫°i phi√™n b·∫£n c·ªßa Collective Idea ƒëang ƒë∆∞·ª£c s·ª≠ d·ª•ng ph·ªï bi·∫øn h∆°n.</p>
<p>B·∫°n c√≥ th·ªÉ t√¨m hi·ªÉu th√™m v·ªÅ delayed_job t·∫°i ƒë·ªãa ch·ªâ <a href="https://github.com/collectiveidea/delayed_job">https://github.com/collectiveidea/delayed_job</a></p>
<p>D∆∞·ªõi ƒë√¢y l√† c√°c b∆∞·ªõc c√†i ƒë·∫∑t v√† s·ª≠ d·ª•ng Delayed_job trong Rails v·ªõi ActiveRecord.</p>
<p>ƒê·ªÉ c√†i ƒë·∫∑t Delayed_job cho Active Record, b·∫°n s·ª≠ d·ª•ng <code>gem ‚Äòdelayed_job_active_record‚Äô</code></p>
<ul>
<li>
<p>Kh·ªüi t·∫°o delayed_job</p>
<pre><code>$ rails g delayed_job:active_record
$ rails db:migrate
</code></pre></li>
<li>
<p>Kh·ªüi ƒë·ªông Worker c·ªßa Delayed_job</p>
<pre><code>$ rake jobs:work
</code></pre></li>
<li>
<p>S·ª≠ d·ª•ng Delayed_job theo c√°ch ƒë∆°n gi·∫£n, v√≠ d·ª• g·ª≠i email cho ng∆∞·ªùi d√πng sau khi ƒëƒÉng k√Ω th√†nh c√¥ng</p>
<ul>
<li>Tr∆∞·ªõc khi s·ª≠ d·ª•ng Delayed_job</li>
</ul>
<pre><code>NotificationMailer.notify_account_activated(@user).deliver
</code></pre></li>
<li>
<p>V·ªõi Delayed_job</p>
<pre><code>    NotificationMailer.delay.notify_account_activated(@user)
</code></pre><p>Ta c≈©ng c√≥ th·ªÉ s·ª≠ d·ª•ng Delayed_job ƒë·ªÉ th·ª±c hi·ªán c√¥ng vi·ªác theo l·ªãch hay ƒë·ªãnh k·ª≥. Trong v√≠ d·ª• n√†y ·ª©ng d·ª•ng s·∫Ω g·ª≠i email ƒë·∫øn ng∆∞·ªùi d√πng v·ª´a k√≠ch ho·∫°t sau m·ªôt ng√†y, v√†o l√∫c 8 gi·ªù s√°ng.</p>
<pre><code>    RAILS_ROOT/lib/delayed_jobs/newsletter_job.rb
     class NewsletterJob &lt; Struct.new(:user)
       def perform
         NewsletterMailer.welcome_mail(user).deliver
       end
     end

     # Controller
     # run at 8 a.m next day
     Delayed::Job.enqueue NewsletterMailer.new(@user) , 0, 1.day.from_now.change({:hour =&gt; 8 })
</code></pre><p>S·ª≠ d·ª•ng Delayed_job v·ªõi Capistrano</p>
</li>
</ul>
<p>Tr∆∞·ªõc ti√™n b·∫°n c·∫ßn c√†i ƒë·∫∑t Ruby gem c√≥ t√™n ‚Äúdaemons‚Äù ƒë·ªÉ ch·∫°y worker c·ªßa delayed_job nh∆∞ m·ªôt process c·ªßa h·ªá th·ªëng.</p>
<pre><code>gem install 'daemons'
</code></pre><pre><code># Location: config/deploy.rb
namespace :delayed_job do
  desc &quot;Start delayed_job process&quot;
  task :start, :roles =&gt; :app do
    run &quot;cd #{current_path}; RAILS_ENV=#{rails_env} script/delayed_job start&quot;
  end

  desc &quot;Stop delayed_job process&quot;
  task :stop, :roles =&gt; :app do
    run &quot;cd #{current_path}; RAILS_ENV=#{rails_env} script/delayed_job stop&quot;
  end

  desc &quot;Restart delayed_job process&quot;
  task :restart, :roles =&gt; :app do
   run &quot;cd #{current_path}; RAILS_ENV=#{rails_env} script/delayed_job restart&quot;
  end
end
</code></pre><p>Nh∆∞ v·∫≠y Whenever v√† Delayed_job s·∫Ω gi√∫p cho b·∫°n th·ª±c hi·ªán c√¥ng vi·ªác theo l·ªãch ƒë·ªãnh s·∫µn, tƒÉng t·ªëc ƒë·ªô ·ª©ng d·ª•ng ƒë·ªëi v·ªõi ng∆∞·ªùi d√πng cu·ªëi v√† tri·ªÉn khai l√™n server m·ªôt c√°ch nhanh ch√≥ng v√† t·ª± ƒë√¥ng.</p>
]]></description>
                    
                        
                    
                    
                        
                            
                        
                            
                        
                    
                </item>
            
        
            
                <item>
                    <title>Export file pdf t·ª´ html trong ·ª©ng d·ª•ng Rails</title>
                    <link>https://tungpv98.github.io/posts/export_file_pdf_from_html_in_rails/</link>
                    <guid isPermaLink="true">https://tungpv98.github.io/posts/export_file_pdf_from_html_in_rails/</guid>
                    <pubDate>Fri, 22 Jan 2021 08:17:31 +0700</pubDate>
                    <description><![CDATA[<p>Pdf l√† m·ªôt trong nh·ªØng ƒë·ªãnh d·∫°ng ph·ªï bi·∫øn hi·ªán nay, v·ªõi ∆∞u ƒëi·ªÉm l√† ch·∫•t l∆∞·ª£ng cao v√† kh√¥ng d·ªÖ b·ªã thay ƒë·ªïi font ch·ªØ hay b·ªë c·ª•c c·ªßa n·ªôi dung. V√¨ th·∫ø pdf th∆∞·ªùng xuy√™n ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ l∆∞u tr·ªØ nh·ªØng n·ªôi dung sau khi ƒë√£ ho√†n thi·ªán v√† d√πng ch√∫ng ƒë·ªÉ trao ƒë·ªïi qua m·∫°ng. Trong m·ªôt s·ªë website nhi·ªÅu t√°c v·ª• c≈©ng c·∫ßn ƒë·∫øn vi·ªác l∆∞u tr·ªØ th√†nh ƒë·ªãnh d·∫°ng pdf ƒë·ªÉ thu·∫≠n ti·ªán cho vi·ªác l∆∞u tr·ªØ l·∫°i c·ªßa ng∆∞·ªùi d√πng, v√¨ th·∫ø h√¥m nay m√¨nh vi·∫øt b√†i vi·∫øt n√†y ƒë·ªÉ t·∫°o m·ªôt website ƒë∆°n gi·∫£n b·∫±ng Ruby on Rails c√≥ t√≠ch h·ª£p t√≠nh nƒÉng xu·∫•t file pdf t·ª´ th√¥ng tin c·ªßa trang web v·ªõi gem PDFKit !!!</p>
<h1 id="t·∫°o-·ª©ng-d·ª•ng-rails">T·∫°o ·ª©ng d·ª•ng Rails</h1>
<p>T·∫°o m·ªôt ·ª©ng d·ª•ng v·ªõi t√™n l√† invoices (h√≥a ƒë∆°n) v√† th√™m 2 models:</p>
<pre><code>$ rails new invoices -d mysql
$ cd invoices
 
$ rails generate model invoice date:date client notes total
$ rails generate model line_item description price:float invoice:references
</code></pre><p>sau ƒë√≥ th√™m m·ªôt s·ªë d·ªØ li·ªáu m·∫´u v√†o c∆° s·ªü d·ªØ li·ªáu b·∫±ng c√°ch th√™m v√†o file <code>db/seeds.rb.</code></p>
<pre><code>invoice = Invoice.create(
  client: 'T√πng Phan',
  total: 165000,
  date: Date.new(2020, 2, 17))

LineItem.create([
  { invoice_id: invoice.id, description: 'Tu·ªïi tr·∫ª ƒë√°ng gi√° bao nhi√™u???', price: 96000 },
  { invoice_id: invoice.id, description: 'M·∫Øt Bi·∫øc (T√°i B·∫£n 2019)', price: 69000} ])
</code></pre><p>Ch·∫°y l·ªánh rails db:seed trong terminal ƒë·ªÉ th√™m h√≥a ƒë∆°n m·∫´u v√†o c∆° s·ªü d·ªØ li·ªáu.</p>
<h3 id="t·∫°o-controller-and-view">T·∫°o controller and view</h3>
<p>ch·∫°y l·ªánh <code>rails generate controller Invoices index show</code>ƒë·ªÉ t·∫°o controllers v√† views.</p>
<p><em><strong>app/models/invoice.rb</strong></em></p>
<pre><code>class Invoice &lt; ApplicationRecord
  has_many :line_items
end
</code></pre><p><em><strong>app/models/line_item.rb</strong></em></p>
<pre><code>class LineItem &lt; ApplicationRecord
  belongs_to :invoice
end
</code></pre><p><em><strong>app/controllers/invoicescontroller.rb</strong></em></p>
<pre><code> class InvoicesController &lt; ApplicationController
  def index
    @invoices = Invoice.all
  end
 
  def show
    @invoice = Invoice.find(params[:id])
  end
end
</code></pre><p><em><strong>app/views/invoices/index.html.erb</strong></em></p>
<pre><code>&lt;h1&gt;H√ìA ƒê∆†N&lt;/h1&gt;
&lt;ul&gt;
  &lt;% @invoices.each do |invoice| %&gt;
  &lt;li&gt;
    &lt;%= link_to &quot;#{invoice.id} - #{invoice.client} - #{invoice.date.strftime(&quot;%B %d, %Y&quot;)} &quot;, invoice_path(invoice) %&gt;
  &lt;/li&gt;
  &lt;% end %&gt;
&lt;/ul&gt;
</code></pre><p><em><strong>app/views/invoices/show.html.erb</strong></em></p>
<pre><code>&lt;div class=&quot;invoice&quot;&gt;
  &lt;h1&gt;CHI TI·∫æT H√ìA ƒê∆†N&lt;/h1&gt;

  &lt;h3&gt;KH√ÅCH H√ÄNG: &lt;%= @invoice.client %&gt;&lt;/h3&gt;
  &lt;h3&gt;NG√ÄY: &lt;%= @invoice.date.strftime(&quot;%B %d, %Y&quot;) %&gt;&lt;/h3&gt;

  &lt;table&gt;
    &lt;thead&gt;
        &lt;tr&gt;
          &lt;th&gt;T√äN S√ÅCH&lt;/th&gt;
          &lt;th&gt;GI√Å&lt;/th&gt;
        &lt;/tr&gt;
      &lt;/thead&gt;
      &lt;tbody&gt;
        &lt;% @invoice.line_items.each do |line_item| %&gt;
          &lt;tr&gt;
            &lt;td&gt;&lt;%= line_item.description %&gt;&lt;/td&gt;
            &lt;td&gt;&lt;%= number_to_currency(line_item.price) %&gt;&lt;/td&gt;
          &lt;/tr&gt;
        &lt;% end %&gt;
        &lt;tr class=&quot;total&quot;&gt;
          &lt;td style=&quot;text-align: right&quot;&gt;TH√ÄNH TI·ªÄN: &lt;/td&gt;
          &lt;td&gt;&lt;%= number_to_currency(@invoice.total) %&gt;&lt;/span&gt;&lt;/td&gt;
        &lt;/tr&gt;
      &lt;/tbody&gt;
  &lt;/table&gt;

  &lt;% if @invoice.notes %&gt;
  &lt;div class=&quot;notes&quot;&gt;
    &lt;p&gt;&lt;strong&gt;L∆ØU √ù:&lt;/strong&gt; &lt;%= @invoice.notes %&gt;&lt;/p&gt;
  &lt;/div&gt;
  &lt;% end %&gt;
&lt;/div&gt;

</code></pre><p><em><strong>app/assets/stylesheets/application.scss</strong></em></p>
<pre><code>.invoice {
  width: 700px;
  max-width: 700px;
  border: 1px solid grey;
  margin: 50px;
  padding: 50px;
 
  h1 {
    text-align: center;
    margin-bottom: 100px;
  }
  .notes {
    margin-top: 100px;
  }
 
  table {
    width: 90%;
    text-align: left;
  }
  th {
    padding-bottom: 15px;
  }
 
  .total td {
    font-size: 20px;
    font-weight: bold;
    padding-top: 25px;
  }
}
</code></pre><p>Sau ƒë√≥ <code>rails s</code> v√† truy c·∫≠p v√†o <code>localhost:3000</code> v√† v√†o xem chi ti·∫øt h√≥a ƒë∆°n</p>
<p><img src="https://images.viblo.asia/a2777314-cc74-4c3a-919d-ef77f04a1cbd.PNG" alt=""></p>
<p>Chi ti·∫øt h√≥a ƒë∆°n</p>
<p><img src="https://images.viblo.asia/03a6eca3-6e49-4299-84d9-343dc6ac425e.PNG" alt=""></p>
<h1 id="t√≠ch-h·ª£p-ch·ª©c-nƒÉng-export-pdf">T√≠ch h·ª£p ch·ª©c nƒÉng export Pdf</h1>
<h3 id="th√™m-c√°c-gem-v√†o-gem-file">Th√™m c√°c gem v√†o gem file</h3>
<pre><code>gem 'pdfkit'
gem 'render_anywhere'
gem 'wkhtmltopdf-binary'
</code></pre><p>Sau ƒë√≥ ch·∫°y l·ªánh <code>bundle install</code> ƒë·ªÉ c√†i ƒë·∫∑t c√°c gem v·ª´a th√™m v√†o</p>
<h3 id="t·∫°o-m·ªôt-class-invoicepdf-trong-th∆∞-m·ª•c-appmodels">T·∫°o m·ªôt class InvoicePdf trong th∆∞ m·ª•c app/models</h3>
<p><em><strong>app/models/Invoice_pdf.rb</strong></em></p>
<pre><code>require &quot;render_anywhere&quot;
 
class InvoicePdf
  include RenderAnywhere
 
  def initialize(invoice)
    @invoice = invoice
  end
 
  def to_pdf
    kit = PDFKit.new(as_html, page_size: 'A4')
    kit.to_file(&quot;#{Rails.root}/public/invoice.pdf&quot;)
  end
 
  def filename
    &quot;Invoice #{invoice.id}.pdf&quot;
  end
 
  private
 
    attr_reader :invoice
 
    def as_html
      render template: &quot;invoices/pdf&quot;, layout: &quot;invoice_pdf&quot;, locals: { invoice: invoice }
    end
end
</code></pre><p><em><strong>app/views/invoices/pdf.html.erb</strong></em></p>
<pre><code>&lt;div class=&quot;invoice&quot;&gt;
  &lt;h1&gt;CHI TI·∫æT H√ìA ƒê∆†N&lt;/h1&gt;
 
  &lt;h3&gt;To: &lt;%= invoice.client %&gt;&lt;/h3&gt;
  &lt;h3&gt;Date: &lt;%= invoice.date.strftime(&quot;%B %d, %Y&quot;) %&gt;&lt;/h3&gt;
 
  &lt;table&gt;
    &lt;thead&gt;
        &lt;tr&gt;
          &lt;th&gt;T√äN S√ÅCH&lt;/th&gt;
          &lt;th&gt;GI√Å&lt;/th&gt;
        &lt;/tr&gt;
      &lt;/thead&gt;
      &lt;tbody&gt;
        &lt;% invoice.line_items.each do |line_item| %&gt;
          &lt;tr&gt;
            &lt;td&gt;&lt;%= line_item.description %&gt;&lt;/td&gt;
            &lt;td&gt;&lt;%= number_to_currency(line_item.price) %&gt;&lt;/td&gt;
          &lt;/tr&gt;
        &lt;% end %&gt;
        &lt;tr class=&quot;total&quot;&gt;
          &lt;td style=&quot;text-align: right&quot;&gt;Total: &lt;/td&gt;
          &lt;td&gt;&lt;%= number_to_currency(invoice.total) %&gt;&lt;/span&gt;&lt;/td&gt;
        &lt;/tr&gt;
      &lt;/tbody&gt;
  &lt;/table&gt;
 
  &lt;% if invoice.notes %&gt;
  &lt;div class=&quot;notes&quot;&gt;
    &lt;p&gt;&lt;strong&gt;L∆ØU √ù:&lt;/strong&gt; &lt;%= invoice.notes %&gt;&lt;/p&gt;
  &lt;/div&gt;
  &lt;% end %&gt;
&lt;/div&gt;
</code></pre><p><em><strong>app/views/layouts/invoice_pdf.html.erb</strong></em></p>
<pre><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
  &lt;title&gt;Envato Invoices&lt;/title&gt;
  &lt;style&gt;
    &lt;%= Rails.application.assets.find_asset('application.scss').to_s %&gt;
  &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;%= yield %&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre><h3 id="t·∫°o-downloadscontroller-ƒë·ªÉ-render-h√≥a-ƒë∆°n-pdf">T·∫°o DownloadsController ƒë·ªÉ Render h√≥a ƒë∆°n PDF</h3>
<p><code>config/routes.rb</code></p>
<pre><code>Rails.application.routes.draw do
  root to: &quot;invoices#index&quot;
 
  resources :invoices, only: [:index, :show] do
    resource :download, only: [:show]
  end
end
</code></pre><p><em><strong>app/controllers/downloadscontroller.rb</strong></em></p>
<pre><code>class DownloadsController &lt; ApplicationController
 
  def show
    respond_to do |format|
      format.pdf { send_invoice_pdf }
    end
  end
 
  private
 
  def invoice_pdf
    invoice = Invoice.find(params[:invoice_id])
    InvoicePdf.new(invoice)
  end
 
  def send_invoice_pdf
    send_file invoice_pdf.to_pdf,
      filename: invoice_pdf.filename,
      type: &quot;application/pdf&quot;,
      disposition: &quot;inline&quot;
  end
end
</code></pre><p>Th√™m link download pdf v√†o h√≥a ƒë∆°n : <code>app/views/invoices/show.html.erb</code></p>
<pre><code>&lt;%= link_to &quot;Download PDF&quot;,
  invoice_download_path(@invoice, format: &quot;pdf&quot;),
  target: &quot;_blank&quot;,
  class: &quot;download&quot; %&gt;
</code></pre><p>Ch·∫°y <code>rails s</code> chuy·ªÉn ƒë·∫øn h√≥a ƒë∆°n chi ti·∫øt, click v√†o <code>Download PDF</code>m·ªôt tab m·ªõi s·∫Ω hi·ªán file pdf h√≥a ƒë∆°n!!!</p>
<h2 id="t√†i-li·ªáu-tham-kh·∫£o">T√†i li·ªáu tham kh·∫£o</h2>
<p><a href="https://www.pdftron.com/blog/rails/how-to-generate-pdf-with-ruby-on-rails/">https://www.pdftron.com/blog/rails/how-to-generate-pdf-with-ruby-on-rails/</a></p>
<p><a href="https://code.tutsplus.com/tutorials/generating-pdfs-from-html-with-rails--cms-22918">https://code.tutsplus.com/tutorials/generating-pdfs-from-html-with-rails--cms-22918</a></p>
]]></description>
                    
                        
                    
                    
                        
                            
                        
                            
                        
                    
                </item>
            
        
            
                <item>
                    <title>T√≠ch h·ª£p &#34;Mod Security&#34; cho Web Application Server ƒë·ªÉ ch·ªëng l·∫°i SQL Injection v√† t·∫•n c√¥ng XSS</title>
                    <link>https://tungpv98.github.io/posts/hello-world/</link>
                    <guid isPermaLink="true">https://tungpv98.github.io/posts/hello-world/</guid>
                    <pubDate>Thu, 21 Jan 2021 14:34:56 +0700</pubDate>
                    <description><![CDATA[<h1 id="gi·ªõi-thi·ªáu">GI·ªöI THI·ªÜU</h1>
<ul>
<li><a href="https://en.wikipedia.org/wiki/ModSecurity">Mod Security</a> l√† m·ªôt module t∆∞·ªùng l·ª≠a c√≥ th·ªÉ t√≠ch h·ª£p v·ªõi c√°c <a href="https://en.wikipedia.org/wiki/Application_server">Web Application Server</a> (m√°y ch·ªß ·ª©ng d·ª•ng web) nh∆∞ Apache, IIS, Nginx cho ph√©p ph√¢n t√≠ch v√† ghi nh·∫≠t k√Ω c√°c lu·ªìng d·ªØ li·ªáu HTTP/S.V·ªõi s·ª± ƒë√≥ng g√≥p t·ª´ d·ª± √°n <a href="https://www.owasp.org/index.php/Category:OWASP_ModSecurity_Core_Rule_Set_Project">ModSecurity Core Rule Set</a> c·ªßa t·ªï ch·ª©c OWASP ƒë√£ gi√∫p ModSecurity tr·ªü n√™n m·∫°nh m·∫Ω v√† linh ƒë·ªông h∆°n trong vi·ªác ph√¢n t√≠ch c√°c h√†nh vi c√≥ nguy c∆° x√¢m h·∫°i an ninh ·ª©ng d·ª•ng web.</li>
<li>Mod Security ƒë·ª©ng tr∆∞·ªõc Web Server, l√†m nhi·ªám v·ª• nh∆∞ m·ªôt firewall ƒë·ªÉ ki·ªÉm so√°t truy c·∫≠p v√†o ra Web Server. C√°c th√¥ng tin ƒëi t·ª´ b√™n ngo√†i v√†o v√† b√™n trong ra s·∫Ω ƒë∆∞·ª£c ki·ªÉm so√°t ch·∫∑t ch·∫Ω ƒë·ªÉ tr√°nh nh·ªØng th√¥ng tin c√≥ th·ªÉ g√¢y h·∫°i cho Web Server hay l√† vi·ªác r√≤ r·ªâ c√°c th√¥ng tin ƒë·∫∑c bi·ªát t·ª´ Web Server ƒë·∫øn Client.</li>
</ul>
<p><img src="https://images.viblo.asia/e5f7886a-8fdd-486b-a2a2-7ed86660645b.png" alt=""></p>
<ul>
<li>Mod Security c√≥ th·ªÉ :</li>
</ul>
<ol>
<li>Request filtering: t·∫•t c·∫£ c√°c request g·ª≠i ƒë·∫øn web server ƒë·ªÅu ƒë∆∞·ª£c ph√¢n t√≠ch v√† c√†n l·ªçc (filter) tr∆∞·ªõc khi ch√∫ng ƒë∆∞·ª£c ƒë∆∞a ƒë·∫øn c√°c modules kh√°c ƒë·ªÉ x·ª≠ l√Ω.</li>
<li>Anti-evasion techniques: paths v√† parameters ƒë∆∞·ª£c chu·∫©n h√≥a tr∆∞·ªõc khi ph√¢n t√≠ch ƒë·ªÉ ch·ªëng evasion techniques.</li>
<li>Understanding of the HTTP protocol: ModSecurity l√† web application firewall n√™n n√≥ c√≥ kh·∫£ nƒÉng hi·ªÉu ƒë∆∞·ª£c HTTP protocol. ModSecurity c√≥ kh·∫£ nƒÉng c√†n l·ªçc d·ª±a tr√™n c√°c th√¥ng tin ·ªü HTTP header hay c√≥ th·ªÉ xem x√©t ƒë·∫øn t·ª´ng parameters hay cookies c·ªßa c√°c requests‚Ä¶</li>
<li>POST payload analysis: ngo√†i vi·ªác c√†n l·ªçc d·ª±a tr√™n HTTP header, ModSecurity c√≥ th·ªÉ d·ª±a tr√™n n·ªôi dung (payload) c·ªßa POST request.</li>
<li>Audit logging: m·ªçi request ƒë·ªÅu c√≥ th·ªÉ ƒë∆∞·ª£c ghi l·∫°i (bao g·ªìm c·∫£ POST) ƒë·ªÉ ng∆∞·ªùi qu·∫£n tr·ªã c√≥ th·ªÉ theo d√µi n·∫øu c·∫ßn.</li>
<li>HTTPS filtering: ModSecurity c√≥ th·ªÉ ph√¢n t√≠ch HTTPS.</li>
<li>Compressed content filtering: ModSecurity s·∫Ω ph√¢n t√≠ch sau khi ƒë√£ decompress c√°c request data.</li>
</ol>
<ul>
<li>V√† trong b√†i vi·∫øt n√†y ch√∫ng ta s·∫Ω ti·∫øn h√†nh t√≠ch h·ª£p Mod Security cho Apache Web Server ƒë·ªÉ ch·ªëng l·∫°i SQL Injection v√† t·∫•n c√¥ng XSS.</li>
</ul>
<h1 id="1-sql-injection-v√†-t·∫•n-c√¥ng-xss-khi-ch∆∞a-t√≠ch-h·ª£p-mod-security">1. SQL Injection v√† t·∫•n c√¥ng XSS khi ch∆∞a t√≠ch h·ª£p Mod Security</h1>
<p>ƒê·ªÉ th·ª≠ nghi·ªám SQL Injection v√† t·∫•n c√¥ng XSS th√¨ m√¨nh s·ª≠ d·ª•ng <a href="https://github.com/ethicalhack3r/DVWA">Damn Vulnerable Web Application (DVWA)</a> m·ªôt ·ª©ng d·ª•ng m√£ ngu·ªìn PHP t·∫≠p h·ª£p s·∫µn c√°c l·ªói logic v·ªÅ b·∫£o m·∫≠t trong ƒë√≥ c√≥ SQL Injection v√† XSS.
Sau khi t·∫£i m√£ ngu·ªìn t·ª´ : <a href="https://github.com/ethicalhack3r/DVWA,">https://github.com/ethicalhack3r/DVWA,</a> gi·∫£i n√©n v√†o th∆∞ m·ª•c C:\xampp\htdocs, kh·ªüi ch·∫°y v√† ƒëƒÉng nh·∫≠p b·∫±ng t√†i kho·∫£n username/password: admin/password th√¨ giao di·ªán trang web nh∆∞ sau:</p>
<p><img src="https://images.viblo.asia/d0c04ae4-15e6-4285-b5db-91ebf9bdc466.PNG" alt=""></p>
<h2 id="11-th·ª≠-nghi·ªám-sql-injection">1.1 Th·ª≠ nghi·ªám SQL Injection</h2>
<p>V√†o SQL Injection nh·∫≠p v√†o <code>%' or '0'='0</code> v√† submit</p>
<p><img src="https://images.viblo.asia/81ef4196-8ae0-46c2-babf-98a588be71fa.PNG" alt=""></p>
<p>K·∫øt qu·∫£ s·∫Ω nh·∫≠n ƒë∆∞·ª£c th√¥ng tin c·ªßa t·∫•t c·∫£ c√°c users c√≥ trong c∆° s·ªü d·ªØ li·ªáu. B·ªüi v√¨ c√¢u truy v·∫•n l√∫c n√†y ƒë∆∞·ª£c hi·ªÉu l√† : <code>SELECT * FROM users WHERE user_id = '%' or '0'='0'</code></p>
<h2 id="12-th·ª≠-nghi·ªám-xss">1.2 Th·ª≠ nghi·ªám XSS</h2>
<p>V√†o XSS stored v√† submit ƒëo·∫°n script sau: <code>&lt;script&gt;alert(&quot;Hacked! ‚Äì KMA&quot;)&lt;/script&gt;</code>:</p>
<p><img src="https://images.viblo.asia/48963635-c553-4709-a729-2384159d592c.PNG" alt=""></p>
<p>Sau khi submit ƒëo·∫°n script tr√™n th√¨ m·ªói l·∫ßn truy c·∫≠p v√†o, trang web s·∫Ω hi·ªán m·ªôt th√¥ng b√°o cho ng∆∞·ªùi d√πng nh∆∞ sau:</p>
<p><img src="https://images.viblo.asia/fd53ef7f-1b77-44f9-8650-8d72b3c4e9fe.PNG" alt=""></p>
<p>Qua m·ªôt v√†i thao t√°c ƒë∆°n gi·∫£n c√≥ th·ªÉ th·∫•y ƒë∆∞·ª£c l·ªói SQL Injection v√† XSS r·∫•t d·ªÖ d√†ng b·ªã khai th√°c. V√¨ v·∫≠y c·∫ßn c√≥ ph∆∞∆°ng ph√°p ƒë·ªÉ ch·ªëng l·∫°i c√°c d·∫°ng t·∫•n c√¥ng n√†y.
C√≥ r·∫•t nhi·ªÅu ph∆∞∆°ng ph√°p ƒë·ªÉ ch·ªëng l·∫°i t·∫•n c√¥ng SQL Injection v√† XSS nh∆∞ng trong b√†i vi·∫øt n√†y m√¨nh ch·ªâ ƒë·ªÅ c·∫≠p ƒë·∫øn ph∆∞∆°ng ph√°p t√≠ch h·ª£p t∆∞·ªùng l·ª≠a v√† c·ª• th·ªÉ l√† Mod Security tr√™n Apache.</p>
<h1 id="2-c√†i-ƒë·∫∑t-v√†-c·∫•u-h√¨nh-mod-security">2 C√†i ƒë·∫∑t v√† c·∫•u h√¨nh Mod Security</h1>
<h2 id="21-c√†i-ƒë·∫∑t">2.1 C√†i ƒë·∫∑t</h2>
<p><strong>Truy c·∫≠p v√†o  <a href="https://www.apachelounge.com/download/">https://www.apachelounge.com/download/</a> v√† t·∫£i v·ªÅ mod_security t∆∞∆°ng ·ª©ng.</strong></p>
<p><img src="https://images.viblo.asia/a1dcd589-50b0-4628-8769-d12d91c0fd37.PNG" alt=""></p>
<p><strong>Gi·∫£i n√©n v√† t√¨m 2 file <code>mod_security2.so</code> v√† <code>yajl.dll</code> trong th∆∞ m·ª•c v·ª´a gi·∫£i n√©n.</strong></p>
<ul>
<li>copy <code>mod_security2.so</code> v√†o <code>...\apache\modules</code></li>
<li>copy <code>yajl.dll</code> vao <code>...\apache\bin</code></li>
</ul>
<p><strong>M·ªü file <code>httpd.conf</code> c·ªßa Xampp v√† th√™m v√†o c√°c d√≤ng sau:</strong></p>
<p><code>LoadModule security2_module modules/mod_security2.so</code></p>
<p><code>SecRuleEngine DetectionOnly</code></p>
<p><code>&lt;IfModule security2_module&gt;</code></p>
<p><code>SecRuleEngine On</code></p>
<p><code>SecDefaultAction &quot;phase:2,deny,log,status:403&quot;</code></p>
<p><code>Include conf/sqlinjection.conf</code></p>
<p><code>Include conf/xss.conf</code></p>
<p><code>&lt;/IfModule&gt;</code></p>
<p><img src="https://images.viblo.asia/500f34af-ef20-4d00-9ba5-165ea0595da6.jpg" alt=""></p>
<h2 id="22-t·∫°o-file-conf-ƒë·ªÉ-thi·∫øt-l·∫≠p-rules">2.2 T·∫°o file conf ƒë·ªÉ thi·∫øt l·∫≠p rules</h2>
<p><strong>Ti·∫øn h√†nh t·∫°o 2 file <code>sqlinjection.conf</code> v√† <code>xss.conf</code> trong th∆∞ m·ª•c <code>apache\conf</code> c·ªßa Xampp.</strong></p>
<p><strong>Clone to√†n b·ªô <a href="https://raw.githubusercontent.com/SEC642/modsec/master/rules/base_rules/modsecurity_crs_41_sql_injection_attacks.conf">rules SQL Injection</a> v√†o file <code>sqlinjection.conf</code> v√† <a href="https://github.com/SEC642/modsec/blob/master/rules/base_rules/modsecurity_crs_41_xss_attacks.conf">rules XSS Injection</a> v√†o file <code>xss.conf</code>.</strong></p>
<p>Ti·∫øn h√†nh restart l·∫°i Xampp Apache. Th·ª≠ nghi·ªám l·∫°i t·∫•n c√¥ng SQL Injection v√† XSS nh∆∞ ·ªü ph·∫ßn 1. K·∫øt qu·∫£ nh∆∞ h√¨nh:</p>
<p><img src="https://images.viblo.asia/571490c9-7c33-4e9d-89ea-8b5a6d64f179.PNG" alt=""></p>
<p>V√† ƒë·ªìng th·ªùi file nh·∫≠t k√Ω ghi nh·∫≠n ƒë∆∞·ª£c request x·∫•u t·ª´ ng∆∞·ªùi d√πng ƒë√£ b·ªã ch·∫∑n l·∫°i:</p>
<p><img src="https://images.viblo.asia/3e272a12-b924-48d5-9e2f-f1201ce55c7f.PNG" alt=""></p>
<p>Video demo:</p>
<p>{@embed: <a href="https://www.youtube.com/watch?v=WRb69P-Oe8Y%7D">https://www.youtube.com/watch?v=WRb69P-Oe8Y}</a></p>
<h1 id="k·∫øt-lu·∫≠n">K·∫øt lu·∫≠n</h1>
<p>Ch·ªâ m·ªôt v√†i b∆∞·ªõc ƒë∆°n gi·∫£n, ch√∫ng ta ƒë√£ c√≥ th·ªÉ ch·ªëng l·∫°i t·∫•n c√¥ng SQL Injection v√† XSS m√† kh√¥ng c·∫ßn ph·∫£i ch·ªânh s·ª≠a l·∫°i m√£ ngu·ªìn c·ªßa trang web. B·∫±ng vi·ªác k·∫øt h·ª£p Mod Security v√† c√°c b·ªô rules do t·ªï ch·ª©c OWASP ƒë·ªÉ ch·ªëng l·∫°i nhi·ªÅu lo·∫°i t·∫•n c√¥ng ph·ªï bi·∫øn v√†o ·ª©ng d·ª•ng web. C≈©ng nh∆∞ c√≥ th·ªÉ vi·∫øt ra c√°c rules ph√π h·ª£p v·ªõi m·ª•c ƒë√≠ch s·ª≠ d·ª•ng c·ªßa ri√™ng t·ª´ng c√° nh√¢n v√† c√¥ng ty. Chi ph√≠ ƒë·∫ßu t∆∞ th·∫•p, ƒë∆∞·ª£c h·ªó tr·ª£ r·ªông r√£i b·ªüi c·ªông ƒë·ªìng b·∫£o m·∫≠t v√¨ v·∫≠y gi·∫£i ph√°p s·ª≠ d·ª•ng Mod Security l√† m·ªôt l·ª±a ch·ªçn r·∫•t t·ªët trong vi·ªác b·∫£o m·∫≠t cho ·ª©ng d·ª•ng web.</p>
<h3 id="cu·ªëi-c√πng">Cu·ªëi c√πng</h3>
<p>B√†i vi·∫øt ƒë∆∞·ª£c vi·∫øt tr√™n s·ª± hi·ªÉu bi·∫øt c√≥ h·∫°n c·ªßa c√° nh√¢n m√¨nh, c√≥ g√¨ sai s√≥t mong ƒë∆∞·ª£c m·ªçi ng∆∞·ªùi g√≥p √Ω! <strong>Thank all!</strong></p>
<h1 id="tham-kh·∫£o">Tham Kh·∫£o</h1>
<p><a href="https://en.wikipedia.org/wiki/ModSecurity">https://en.wikipedia.org/wiki/ModSecurity</a></p>
<p><a href="https://keirstenbrager.tech/sql-vs-xxs-injection-attacks-explained/">https://keirstenbrager.tech/sql-vs-xxs-injection-attacks-explained/</a></p>
]]></description>
                    
                        
                    
                    
                        
                            
                        
                            
                        
                    
                </item>
            
        
    </channel>
</rss>